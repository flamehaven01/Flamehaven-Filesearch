<!DOCTYPE html>
<html class="dark" lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filesearch Ops - Metrics</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "surface-dark": "#1d2833",
            "border-dark": "#324d67",
            "text-main-dark": "#e1eaf2",
            "text-secondary-dark": "#92adc9",
            "success": "#38A169",
            "error": "#E53E3E"
          },
          fontFamily: { "display": ["Inter", "sans-serif"] },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-main-dark">
  <div class="flex min-h-screen">
    <!-- SideNavBar -->
    <aside class="flex h-screen flex-col justify-between bg-surface-dark/50 p-4 w-64 border-r border-border-dark">
      <div class="flex flex-col gap-4">
        <div class="flex gap-3 items-center">
          <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Abstract gradient logo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBSRe6aCEChDJPLBphsa_t4GP2ZvVu3tM8PNvFwl9_dQcjWaApcFbSxpGk8cKF-vMPaRJtNKPbzJSt90jrRkZw3qaeXHGCzIpHphbveA5bxqwptT09kgOBX6ZvriZoSx0WFFnzYdPFjLVk_EDGx-FX0lBE9JWaxw54pm9S1f8KgLJM9pWJYxF84dc3Votj9PX142Nlehglwp7Ior5rvBPuj2Ct_kPJu_oTQOseOb6w-aZQvgd36Tk-rtk5kbvvT1WiKETu0_QAYF9s");'></div>
          <div class="flex flex-col">
            <h1 class="text-text-main-dark text-base font-medium leading-normal">Filesearch Ops</h1>
            <p class="text-text-secondary-dark text-sm font-normal leading-normal">Metrics</p>
          </div>
        </div>
        <nav class="flex flex-col gap-2 mt-4">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
            <span class="material-symbols-outlined">dashboard</span>
            <p class="text-sm font-medium leading-normal">Dashboard</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="search_new.html">
            <span class="material-symbols-outlined">search</span>
            <p class="text-sm font-medium leading-normal">Search</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="upload_new.html">
            <span class="material-symbols-outlined">upload_file</span>
            <p class="text-sm font-medium leading-normal">Upload</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="cache_new.html">
            <span class="material-symbols-outlined">hub</span>
            <p class="text-sm font-medium leading-normal">Cache</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-primary" href="metrics_new.html">
            <span class="material-symbols-outlined">monitoring</span>
            <p class="text-sm font-medium leading-normal">Metrics</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="admin.html">
            <span class="material-symbols-outlined">admin_panel_settings</span>
            <p class="text-sm font-medium leading-normal">Admin</p>
          </a>
        </nav>
      </div>
      <div class="flex flex-col gap-1">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="https://github.com/flamehaven01/Flamehaven-Filesearch" title="Open docs/help">
          <span class="material-symbols-outlined">help</span>
          <p class="text-sm font-medium leading-normal">Help</p>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
          <span class="material-symbols-outlined">logout</span>
          <p class="text-sm font-medium leading-normal">Logout</p>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <div class="mx-auto max-w-7xl">
        <!-- PageHeading -->
        <header class="flex flex-wrap justify-between items-center gap-3 mb-6">
          <h1 class="text-text-main-dark text-4xl font-black leading-tight tracking-[-0.033em]">Metrics &amp; Health</h1>
        </header>
        <!-- Metrics body -->
        <div class="flex items-center gap-3 mb-4">
          <input id="metricsToken" class="h-10 rounded-lg bg-[#233648] text-white text-sm px-3 border border-[#324d67]" placeholder="Bearer token" />
          <button id="btn-refresh-metrics" class="flex h-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-primary px-4 text-sm font-semibold text-white shadow-sm hover:bg-primary/80">
            <span class="material-symbols-outlined text-lg">refresh</span>
            <span class="ml-1">Refresh</span>
          </button>
        </div>
        <div class="grid grid-cols-1 gap-4 py-6 sm:grid-cols-2 lg:grid-cols-3">
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Uptime (s)</p>
            <p id="uptime" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Requests last 60s</p>
            <p id="req60" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Errors last 60s</p>
            <p id="err60" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Cache Hits</p>
            <p id="hits" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Cache Misses</p>
            <p id="misses" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
          <div class="flex flex-1 flex-col gap-2 rounded-lg border border-[#324d67] bg-[#111a22]/50 p-6">
            <p class="text-white text-base font-medium leading-normal">Health</p>
            <p id="health" class="text-white tracking-light text-3xl font-bold leading-tight">--</p>
          </div>
        </div>
        <div class="mt-6 p-4 rounded-lg border border-[#324d67] bg-[#1a202c] text-white text-sm">
          <p class="text-[#92adc9]">GET /metrics provides cache, health, and Prometheus summary (recent request/error counters). Supply a Bearer token if required.</p>
          <pre id="metricsRaw" class="text-xs text-text-secondary-dark whitespace-pre-wrap mt-2"></pre>
        </div>
      </div>
    </main>
  </div>
  <script>
    (() => {
      const tokenEl = document.getElementById("metricsToken");
      const btnRefresh = document.getElementById("btn-refresh-metrics");
      const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
      const raw = document.getElementById("metricsRaw");

      const refresh = async () => {
        setText("uptime", "--");
        setText("req60", "--");
        setText("err60", "--");
        setText("hits", "--");
        setText("misses", "--");
        setText("health", "--");
        raw.textContent = "";
        try {
          const resp = await fetch("/metrics", { headers: tokenEl?.value ? { Authorization: `Bearer ${tokenEl.value}` } : {} });
          if (!resp.ok) throw new Error(resp.statusText);
          const data = await resp.json();
          setText("uptime", data.uptime_seconds ?? "--");
          const p = data.prometheus || {};
          setText("req60", p.requests_last_60s ?? "--");
          setText("err60", p.errors_last_60s ?? "--");
          setText("hits", p.cache_hits_total ?? "--");
          setText("misses", p.cache_misses_total ?? "--");
          setText("health", data.health_status ?? "unknown");
          raw.textContent = JSON.stringify(data, null, 2);
        } catch (err) {
          raw.textContent = `Error: ${err.message}`;
        }
      };

      btnRefresh?.addEventListener("click", (e) => {
        e.preventDefault();
        refresh();
      });

      refresh();
    })();
  </script>
</body></html>
