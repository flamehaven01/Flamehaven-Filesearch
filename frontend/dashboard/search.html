<!DOCTYPE html>
<html class="dark" lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filesearch Ops - Search</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "surface-dark": "#1d2833",
            "border-dark": "#324d67",
            "text-main-dark": "#e1eaf2",
            "text-secondary-dark": "#92adc9",
            "success": "#38A169",
            "error": "#E53E3E"
          },
          fontFamily: { "display": ["Inter", "sans-serif"] },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-main-dark">
  <div class="flex min-h-screen">
    <!-- SideNavBar -->
    <aside class="flex h-screen flex-col justify-between bg-surface-dark/50 p-4 w-64 border-r border-border-dark">
      <div class="flex flex-col gap-4">
        <div class="flex gap-3 items-center">
          <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Abstract gradient logo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBSRe6aCEChDJPLBphsa_t4GP2ZvVu3tM8PNvFwl9_dQcjWaApcFbSxpGk8cKF-vMPaRJtNKPbzJSt90jrRkZw3qaeXHGCzIpHphbveA5bxqwptT09kgOBX6ZvriZoSx0WFFnzYdPFjLVk_EDGx-FX0lBE9JWaxw54pm9S1f8KgLJM9pWJYxF84dc3Votj9PX142Nlehglwp7Ior5rvBPuj2Ct_kPJu_oTQOseOb6w-aZQvgd36Tk-rtk5kbvvT1WiKETu0_QAYF9s");'></div>
          <div class="flex flex-col">
            <h1 class="text-text-main-dark text-base font-medium leading-normal">Filesearch Ops</h1>
            <p class="text-text-secondary-dark text-sm font-normal leading-normal">Search</p>
          </div>
        </div>
        <nav class="flex flex-col gap-2 mt-4">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
            <span class="material-symbols-outlined">dashboard</span>
            <p class="text-sm font-medium leading-normal">Dashboard</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-primary" href="search_new.html">
            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">search</span>
            <p class="text-sm font-medium leading-normal">Search</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="upload_new.html">
            <span class="material-symbols-outlined">upload_file</span>
            <p class="text-sm font-medium leading-normal">Upload</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="cache_new.html">
            <span class="material-symbols-outlined">hub</span>
            <p class="text-sm font-medium leading-normal">Cache</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="metrics_new.html">
            <span class="material-symbols-outlined">monitoring</span>
            <p class="text-sm font-medium leading-normal">Metrics</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="admin.html">
            <span class="material-symbols-outlined">admin_panel_settings</span>
            <p class="text-sm font-medium leading-normal">Admin</p>
          </a>
        </nav>
      </div>
      <div class="flex flex-col gap-1">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="https://github.com/flamehaven01/Flamehaven-Filesearch" title="Open docs/help">
          <span class="material-symbols-outlined">help</span>
          <p class="text-sm font-medium leading-normal">Help</p>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
          <span class="material-symbols-outlined">logout</span>
          <p class="text-sm font-medium leading-normal">Logout</p>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <div class="mx-auto max-w-7xl">
        <!-- PageHeading -->
        <header class="flex flex-wrap justify-between items-center gap-3 mb-6">
          <h1 class="text-text-main-dark text-4xl font-black leading-tight tracking-[-0.033em]">Search Console</h1>
        </header>
        <!-- Search body -->
        <div class="flex flex-col gap-4">
          <div class="flex items-center gap-2">
            <input id="bearerToken" class="h-10 rounded-lg bg-[#233648] text-white text-sm px-3 w-80" placeholder="Bearer token" />
            <select id="store" class="h-10 rounded-lg bg-[#233648] text-white text-sm px-3">
              <option value="default">default</option>
            </select>
          </div>
          <label class="flex flex-col w-full">
            <p class="text-[#A0AEC0] text-sm font-medium leading-normal pb-2">Query</p>
            <textarea id="query" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white focus:outline-0 focus:ring-1 focus:ring-primary border-none bg-[#233648] min-h-24 placeholder:text-[#92adc9] p-4 text-base font-normal leading-normal" placeholder="Enter a query to begin your search..."></textarea>
          </label>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="flex flex-col w-full">
                <p class="text-[#A0AEC0] text-sm font-medium leading-normal pb-2">Model</p>
                <select id="model" class="form-select flex w-full min-w-0 flex-1 rounded-lg text-white focus:outline-0 focus:ring-1 focus:ring-primary border-none bg-[#233648] p-3 text-base font-normal leading-normal">
                  <option value="default">default</option>
                  <option value="gemini-2.5-flash">gemini-2.5-flash</option>
                  <option value="local">local</option>
                </select>
              </label>
            </div>
            <div>
              <label class="flex flex-col w-full">
                <div class="flex justify-between items-center pb-2">
                  <p class="text-[#A0AEC0] text-sm font-medium leading-normal">Temperature</p>
                  <span id="tempVal" class="text-white text-sm font-medium">0.5</span>
                </div>
                <input id="temperature" class="w-full h-2 bg-[#233648] rounded-lg appearance-none cursor-pointer accent-primary" max="1" min="0" step="0.1" type="range" value="0.5" oninput="document.getElementById('tempVal').innerText=this.value" />
              </label>
            </div>
            <div>
              <label class="flex flex-col w-full">
                <div class="flex justify-between items-center pb-2">
                  <p class="text-[#A0AEC0] text-sm font-medium leading-normal">Max Tokens</p>
                  <span id="tokensVal" class="text-white text-sm font-medium">1024</span>
                </div>
                <input id="maxTokens" class="w-full h-2 bg-[#233648] rounded-lg appearance-none cursor-pointer accent-primary" max="4096" min="1" step="1" type="range" value="1024" oninput="document.getElementById('tokensVal').innerText=this.value" />
              </label>
            </div>
            <div class="flex items-end">
              <button id="btn-run" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 bg-primary text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] px-4 hover:bg-primary/80">
                <span class="material-symbols-outlined">search</span>
                <span>Run Query</span>
              </button>
            </div>
          </div>
          <div class="mt-8">
            <h3 class="text-lg font-bold text-white mb-2">Results</h3>
            <div id="results" class="p-4 bg-[#1a202c] rounded-lg border border-[#233648] text-white text-sm">
              <p class="text-[#92adc9]">Run a query to see results. POST /api/search with {query, store, model, max_tokens, temperature}. The response will render here.</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    (() => {
      const btn = document.getElementById("btn-run");
      const tokenInput = document.getElementById("bearerToken");
      const queryEl = document.getElementById("query");
      const modelEl = document.getElementById("model");
      const tempEl = document.getElementById("temperature");
      const tokensEl = document.getElementById("maxTokens");
      const resultsEl = document.getElementById("results");

      const postSearch = async () => {
        const payload = {
          query: queryEl.value || "example query",
          store: "default",
          model: modelEl.value || "default",
          temperature: Number(tempEl.value || 0.5),
          max_tokens: Number(tokensEl.value || 1024),
        };
        try {
          const resp = await fetch("/api/search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              ...(tokenInput.value ? { Authorization: `Bearer ${tokenInput.value}` } : {}),
            },
            body: JSON.stringify(payload),
          });
          if (!resp.ok) {
            resultsEl.innerHTML = `<p class="text-error">Request failed: ${resp.status} ${resp.statusText}</p>`;
            return;
          }
          const data = await resp.json();
          resultsEl.innerHTML = `
            <div class="mb-3 text-xs text-[#92adc9]">request_id: ${data.request_id || "n/a"}</div>
            <div class="p-4 rounded-lg bg-[#111a22] border border-[#233648]">
              <p class="text-white text-sm font-semibold pb-2">Answer</p>
              <p class="text-[#92adc9] text-sm">${data.answer || "(no answer)"} </p>
            </div>
            <div class="p-4 rounded-lg bg-[#111a22] border border-[#233648] mt-3">
              <p class="text-white text-sm font-semibold pb-2">Sources</p>
              <pre class="text-[#92adc9] text-xs whitespace-pre-wrap">${JSON.stringify(data.sources || [], null, 2)}</pre>
            </div>
          `;
        } catch (e) {
          resultsEl.innerHTML = `<p class="text-error">Request failed: ${e.message}</p>`;
        }
      };
      btn?.addEventListener("click", (e) => {
        e.preventDefault();
        postSearch();
      });
    })();
  </script>
</body></html>
