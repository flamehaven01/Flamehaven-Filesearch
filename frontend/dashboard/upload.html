<!DOCTYPE html>
<html class="dark" lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filesearch Ops - Upload</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "surface-dark": "#1d2833",
            "border-dark": "#324d67",
            "text-main-dark": "#e1eaf2",
            "text-secondary-dark": "#92adc9",
            "success": "#38A169",
            "error": "#E53E3E"
          },
          fontFamily: { "display": ["Inter", "sans-serif"] },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-main-dark">
  <div class="flex min-h-screen">
    <!-- SideNavBar -->
    <aside class="flex h-screen flex-col justify-between bg-surface-dark/50 p-4 w-64 border-r border-border-dark">
      <div class="flex flex-col gap-4">
        <div class="flex gap-3 items-center">
          <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Abstract gradient logo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBSRe6aCEChDJPLBphsa_t4GP2ZvVu3tM8PNvFwl9_dQcjWaApcFbSxpGk8cKF-vMPaRJtNKPbzJSt90jrRkZw3qaeXHGCzIpHphbveA5bxqwptT09kgOBX6ZvriZoSx0WFFnzYdPFjLVk_EDGx-FX0lBE9JWaxw54pm9S1f8KgLJM9pWJYxF84dc3Votj9PX142Nlehglwp7Ior5rvBPuj2Ct_kPJu_oTQOseOb6w-aZQvgd36Tk-rtk5kbvvT1WiKETu0_QAYF9s");'></div>
          <div class="flex flex-col">
            <h1 class="text-text-main-dark text-base font-medium leading-normal">Filesearch Ops</h1>
            <p class="text-text-secondary-dark text-sm font-normal leading-normal">Upload</p>
          </div>
        </div>
        <nav class="flex flex-col gap-2 mt-4">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
            <span class="material-symbols-outlined">dashboard</span>
            <p class="text-sm font-medium leading-normal">Dashboard</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="search_new.html">
            <span class="material-symbols-outlined">search</span>
            <p class="text-sm font-medium leading-normal">Search</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-primary" href="upload_new.html">
            <span class="material-symbols-outlined">upload_file</span>
            <p class="text-sm font-medium leading-normal">Upload</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="cache_new.html">
            <span class="material-symbols-outlined">hub</span>
            <p class="text-sm font-medium leading-normal">Cache</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="metrics_new.html">
            <span class="material-symbols-outlined">monitoring</span>
            <p class="text-sm font-medium leading-normal">Metrics</p>
          </a>
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="admin.html">
            <span class="material-symbols-outlined">admin_panel_settings</span>
            <p class="text-sm font-medium leading-normal">Admin</p>
          </a>
        </nav>
      </div>
      <div class="flex flex-col gap-1">
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="https://github.com/flamehaven01/Flamehaven-Filesearch" title="Open docs/help">
          <span class="material-symbols-outlined">help</span>
          <p class="text-sm font-medium leading-normal">Help</p>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-lg text-text-secondary-dark hover:bg-surface-dark" href="landing_new.html">
          <span class="material-symbols-outlined">logout</span>
          <p class="text-sm font-medium leading-normal">Logout</p>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <div class="mx-auto max-w-7xl">
        <!-- PageHeading -->
        <header class="flex flex-wrap justify-between items-center gap-3 mb-6">
          <h1 class="text-text-main-dark text-4xl font-black leading-tight tracking-[-0.033em]">Upload / Index</h1>
        </header>
        <!-- Upload body -->
        <div class="flex flex-wrap items-center gap-3 mb-4">
          <input id="uploadToken" class="h-10 rounded-lg bg-[#233648] text-white text-sm px-3 border border-[#324d67]" placeholder="Bearer token" />
          <input id="uploadStore" class="h-10 rounded-lg bg-[#233648] text-white text-sm px-3 border border-[#324d67]" value="default" placeholder="Store name" />
          <button id="btn-upload-files" class="flex h-10 min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary px-4 text-sm font-bold text-white transition-opacity hover:opacity-90">
            <span>Upload</span>
          </button>
          <input id="fileInput" type="file" multiple class="hidden" />
          <button id="btn-select-files" class="flex h-10 min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary px-5 text-sm font-bold text-white transition-opacity hover:opacity-90">
            <span>Select Files</span>
          </button>
        </div>
        <div id="uploadStatus" class="text-sm text-text-secondary-dark mt-2"></div>
        <div class="mt-8 p-4 rounded-lg border border-[#324d67] bg-[#1a202c] text-white text-sm">
          <p class="text-[#92adc9]">POST /api/upload/single or /multiple with FormData (files, store). This UI will show a status message after upload.</p>
        </div>
      </div>
    </main>
  </div>
  <script>
    (() => {
      const tokenEl = document.getElementById("uploadToken");
      const storeEl = document.getElementById("uploadStore");
      const fileInput = document.getElementById("fileInput");
      const statusEl = document.getElementById("uploadStatus");
      const selectBtn = document.getElementById("btn-select-files");
      const uploadBtn = document.getElementById("btn-upload-files");

      const showStatus = (msg, isError = false) => {
        if (!statusEl) return;
        statusEl.textContent = msg;
        statusEl.classList.toggle("text-error", isError);
      };

      selectBtn?.addEventListener("click", (e) => {
        e.preventDefault();
        fileInput?.click();
      });

      const upload = async () => {
        if (!fileInput?.files?.length) {
          showStatus("Select at least one file first", true);
          return;
        }
        const store = storeEl?.value || "default";
        const multiple = fileInput.files.length > 1;
        const fd = new FormData();
        if (multiple) {
          Array.from(fileInput.files).forEach((f) => fd.append("files", f));
        } else {
          fd.append("file", fileInput.files[0]);
        }
        fd.append("store", store);
        const endpoint = multiple ? "/api/upload/multiple" : "/api/upload/single";
        showStatus(`Uploading to ${store}...`);
        try {
          const resp = await fetch(endpoint, {
            method: "POST",
            headers: tokenEl?.value ? { Authorization: `Bearer ${tokenEl.value}` } : undefined,
            body: fd,
          });
          const data = await resp.json();
          if (!resp.ok) {
            showStatus(`Failed (${resp.status}): ${data.detail || "upload error"}`, true);
            return;
          }
          showStatus(`Uploaded ${multiple ? "files" : "file"} to ${store}. Job: ${data.request_id || "n/a"}`, false);
        } catch (err) {
          showStatus(`Upload error: ${err.message}`, true);
        }
      };

      uploadBtn?.addEventListener("click", (e) => {
        e.preventDefault();
        upload();
      });
    })();
  </script>
</body></html>
